<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <title>Prayer Pair Creator</title>
  <script src="js/jquery-1.9.1.js" type="text/javascript"></script>
  <script src="js/bootstrap.js" type="text/javascript"></script>
  <link href="css/bootstrap.css" rel="stylesheet" type="text/css">
  <link rel="stylesheet" href="css/selectize.default.css">

  <style>
#excelDataTable tr td:nth-child(2) {
  padding: 0px;
}

#groupDataTable td:hover {
    cursor: pointer;
}

.table {
  border-top:none;
  border-bottom:none;
  margin-top: 0px;
  margin-bottom: 0px;
}

input.blacklist-select {
    border: 1px solid #d0d0d0;
    padding: 8px 8px;
    display: inline-block;
    width: 100%;
    overflow: hidden;
    position: relative;
    z-index: 1;
    -webkit-box-sizing: border-box;
    -moz-box-sizing: border-box;
    box-sizing: border-box;
    -webkit-box-shadow: inset 0 1px 1px rgba(0, 0, 0, 0.1);
    box-shadow: inset 0 1px 1px rgba(0, 0, 0, 0.1);
    -webkit-border-radius: 3px;
    -moz-border-radius: 3px;
    border-radius: 3px;
    background: #ffffff;
    cursor: text;
    display: inline-block;
    color: #303030;
    font-family: inherit;
    font-size: 13px;
    line-height: 18px;
}
  </style>
    <!--[if IE 8]><script src="js/es5.js"></script><![endif]-->
    <!--<script src="js/jquery.js"></script>-->
  <script src="js/selectize.js"></script>
<script>

var currentdb, groupdb, pairdb, db;


function getDBJSONValue(key) {
  var j = window.localStorage[key];
  if (j && j != 'undefined') {
    return JSON.parse(j);
  }
  return undefined;
}

function setDBJSONValue(key, value) {
  window.localStorage[key] = JSON.stringify(value);
  return getDBJSONValue(key);
}


function setDBToGroup(group) {
  return db = getDBJSONValue('ppdb')[group] || undefined;
}

function getCurrentGroup() {
  return currentdb = getDBJSONValue('currentppgroup');
}

function setCurrentGroup(group) {
  return currentdb = setDBJSONValue('currentppgroup', group);
}

// Initialize from db
groupdb = getDBJSONValue('ppdb') || {};
pairdb = getDBJSONValue('pairdb') || {paircount: 0};  //  paircount -> How many times we've uniquely paired each person

// pick which group to show
currentdb = getCurrentGroup();
db = groupdb[currentdb] || undefined;



function saveDB(dontsavecurrentdb) {
  if (!dontsavecurrentdb) {
    groupdb[currentdb] = db;
  }
  setDBJSONValue('ppdb', groupdb);
}

function addPerson(name) {
  db[name] = {
    name: name,
    blacklist: {},   // Set
    history: {}  // Set
  };

  pairdb[name] = [];

  saveDB();


  return db[name];
}

// Returns a random integer between min (included) and max (excluded)
// Using Math.round() will give you a non-uniform distribution!
function getRandomInt(min, max) {
  return Math.floor(Math.random() * (max - min)) + min;
}

// Array Remove - By John Resig (MIT Licensed)
Array.prototype.remove = function(from, to) {
  var rest = this.slice((to || from) + 1 || this.length);
  this.length = from < 0 ? this.length + from : from;
  return this.push.apply(this, rest);
};

// Array to dictionary (e.g. ['a', 'b', 'c'] -> {'a': 0, 'b': 1, 'c': '2'})
Array.prototype.toDict = function() {
  var dict = {};
  for (var i=0; i<this.length; i++) {
    dict[this[i]] = i;
  }
  return dict;
}

// Translate set to array
function _setToArray(dict) {
  var array = [];
  for (var key in dict) {
    if (dict.hasOwnProperty(key)) {
      array.push(key);
    }
  }
  return array;
}

// Translate set to array
function _dictToArray(dict) {
  var array = [];
  for (var key in dict) {
    if (dict.hasOwnProperty(key)) {
      array.push(dict[key]);
    }
  }
  return array;
}

function _dictKeysToArray(dict) {
  var array = [];
  for (var key in dict) {
    if (dict.hasOwnProperty(key)) {
      array.push(key);
    }
  }
  return array;
}

function pickRandomMatch(dbtemp, name) {
  var pick1, pick2, ri, name2, keys;
  var matched = false;

  pick1 = db[name];
  // pop name out of db
  dbtemp[name] = pick1;
  delete db[name];

  // dump out all the keys
  keys = [];
  for (var key in db) {
    // only push in valid keys to randomly pick from
    // Check not in history or blacklist (blacklist check both sides b/c not necessarily symmetrical)
    if (!(key in pick1.history || key in pick1.blacklist || pick1.name in db[key].blacklist)) {
      keys.push(key);
    }
  };

  // Keep randomly picking while there are options left
  while(!matched && keys.length > 0) {
    // randomly pick a key
    ri = getRandomInt(0, keys.length);
    name2 = keys[ri];
    console.log('kes', ri, keys.length)
    keys.remove(ri);  // remove once picked so won't pick again
    pick2 = db[name2];

    // match it!
    console.log('matched!', name, name2);
    // add to pair list + both histories
    var pc = calculationPairCount();
    pick1.history[name2] = pc;
    pick2.history[name] = pc;
    // pairdb[name].push(name2);
    // pairdb[name2].push(name);

    // pop out pick2
    delete db[name2];
    // push into dbtemp for commit
    dbtemp[name2] = pick2;

    matched = true; // end the loop
  }

  return matched;
}

function pickAll(dbtemp) {
  for (var name in db) {
    // if no match, need to give up, and throw
    if (!pickRandomMatch(dbtemp, name)) {
      // reset db
      console.log('resetting to group', getCurrentGroup());
      db = groupdb[getCurrentGroup];
      setDBToGroup(getCurrentGroup());
      // $('#pairWarning').modal('show');
      console.error('Could be out of solutions: did not match ' + name);
      return false;
    }
  }

  return true;
}

function pairup() {
  var count = 0;
  var pick1, pick2;

  // Check db is even before proceeding
  for (name in db) {
    count++;
  }

  if (count % 2 != 0) {
    alert("You don't have an even number of people, can't do a perfect pairing. quiting");
    return false;
  }



  var noSolution = true;
  var tries = 0;
  while(noSolution && tries < 100) {
    var dbtemp = {};
    noSolution = !pickAll(dbtemp);
    tries++;
  }

  if (noSolution) {
    $('#pairWarning').modal('show');
  }

  // for (var name in db) {
  //   // if no match, need to give up, and throw
  //   if (!pickRandomMatch(dbtemp, name)) {
  //     // reset db
  //     db = getDBJSONValue('ppdb');
  //     // $('#pairWarning').modal('show');
  //     throw 'Could be out of solutions: did not match ' + name;
  //     console.log('asdf');
  //   }
  // }

  // double check dbtemp should be empty after all the picking
  for (key in db) {
    throw 'db should be empty but found: ' + key + ':' + JSON.stringify(db);
  }

  // pairdb.paircount++;

  // commit back to db
  db = dbtemp;
  saveDB();

  // console.log('soln', pairdb);

  refreshTable();

}

function clearHistory() {
  for (var name in db) {
    db[name].history = {};
  }
}

function calculationPairCount() {
  var paircount = 0;
  for (var key in db) {
    paircount = Math.max(_setToArray(db[key].history).length, paircount);
  }
  return paircount;
}

function clearPairing() {
  // for (var name in pairdb) {
  //   pairdb[name] = [];
  // }

  // pairdb.paircount = 0;
}

function clearState() {
  clearPairing();
  clearHistory();
  saveDB();
  refreshTable();
}

function initState() {
  addPerson('Mike Li')
  addPerson('Ray Li')
  addPerson('Richard Li')
  addPerson('Rena Li')
}

var DEFAULT_MENU_TITLE = 'Prayer Pair generator!';


function showPoolEmptyWell() {
  $('#groupDataTable').html('<div class="alert alert-default" role="alert" style="margin:50px;"><h4 class="text-center"><span class="glyphicon glyphicon-exclamation-sign" aria-hidden="true"></span> You currently have no groups!</h4> <div class="text-center"><button data-toggle="modal" data-target="#addGroupModal" class="btn btn-success btn-lg">Add a New Group!</button></div></div>');
}

function showGroupEmptyWell() {
  $('#excelDataTable').html('<div class="alert alert-default" role="alert" style="margin:50px;"><h4 class="text-center"><span class="glyphicon glyphicon-exclamation-sign" aria-hidden="true"></span> You currently have no people in your pool!</h4> <div class="text-center"><button data-toggle="modal" data-target="#editUserModal" class="btn btn-success btn-lg">Add people to your pool!</button></div></div>');
}

function toTitleCase(str) {
  return str.replace(/\w\S*/g, function(txt){return txt.charAt(0).toUpperCase() + txt.substr(1).toLowerCase();});
}

function translateCellValue(item, key, value) {

  // convert blacklist into input
  if (key == 'blacklist') {
    // console.log(key, value);
    var multiselect = '<input data-person="' + item.name + '" type="text" placeholder="People avoid pairing with..." class="demo-default blacklist-select" value="' + _setToArray(value).toString() + '">';
    // Set the value to comma-delimited list as pre-selected values
    // return multiselect.attr('value', _setToArray(value).toString());
    return multiselect;
  } else if (key == 'history') {
    var list = _setToArray(value);
    // var div = $('<table class="row"></table');
    var div = [];
    for (var i=0; i<list.length; i++) {
      div.push('<td class="">' + list[i] + '</td>');
    }
    // div.append(tr);
    return div;
  } else {
    return JSON.stringify(value);
  }
}

// Builds the HTML Table out of myList.
// Returns true if table none-empty, else false
function buildHtmlTable(selector, db, actionCol) {
  var columns = addAllColumnHeaders(db, selector, actionCol),
      columnLength = columns.length,
      html = '';

  if (actionCol) {
    columnLength--;
  }

  for (var i in db) {
    if (!db.hasOwnProperty(i)) {
      continue;
    }
    var row$ = '<tr>';
    for (var colIndex = 0 ; colIndex < columnLength ; colIndex++) {
      // console.log('colinex', colIndex)
      var item = db[i];
      var cellValue = item[columns[colIndex]];

      if (cellValue == null) {
        cellValue = "";
      } else if (typeof cellValue === 'object') {
        // cellValue = JSON.stringify(cellValue);
        cellValue = translateCellValue(item, columns[colIndex], cellValue);
      }

      // catch case when cell hold many cells
      if ($.isArray(cellValue) && cellValue.length > 0) {
        row$ += cellValue;
      } else {
        row$ += '<td>' + (cellValue) + '</td>';
      }
    }

    // console.log('build', actionCol, colIndex, row$);

    if (actionCol) {
      row$ += '<td>' + actionCol.value + '</td>';
    }

    row$ += '</tr>';

    html += row$;
  }

  $(selector).html(html);

  if (columnLength <= 0) {
    return false;
  } else {
    return true;
  }
}

function calculateTR(headerTr$, key) {
  var header = $('<th/>');
  headerTr$.append(header.html(toTitleCase(key)));
  if (key == 'history') {
    header.attr('colspan', Math.max(calculationPairCount(), 1));
  }
}

// Adds a header row to the table and returns the set of columns.
// Need to do union of keys from all records as some records may not contain
// all records
function addAllColumnHeaders(db, selector, actionCol) {
  var columnSet = {};
  var columnList = [];
  var headerTr$ = $('<tr/>');

  for (var i in db) {
    var rowHash = db[i];
    for (var key in rowHash) {
      if (!(key in columnSet)) {
        columnSet[key] = 1;
        columnList.push(key);
        calculateTR(headerTr$, key);
      }
    }
  }

  // add optinal action col
  if (columnList.length > 0 && actionCol) {
    var an = actionCol.name;
    columnList.push(an);
    calculateTR(headerTr$, an);
  }

  $(selector).append(headerTr$);

  return columnList;
}

function refreshTable() {
  $('#excelDataTable').html('');
  buildFullTable();
  // initializeBlacklist();
}

function initializeBlacklist() {
  // initialize all the blacklist plugins
  $('.blacklist-select').selectize({
    delimiter: ',',
    plugins: ['remove_button'],
    maxItems: null,
    valueField: 'name',
    labelField: 'name',
    searchField: 'name',
    options: _dictToArray(db),
    create: true,
    onItemAdd: function(value, $item) {
      // Add to person's black list
      var p = db[this.$input.data('person')];
      p.blacklist[value] = true;
      console.log('add', this, value, $item, this.$input.data('person'));
      saveDB();
    },
    onItemRemove: function(value) {
      var p = db[this.$input.data('person')];
      delete p.blacklist[value];
      console.log('delete', value);
      saveDB();
    },
    onBlur: function() {
      saveDB();
    },
    onOptionAdd: function(value, data) {
      console.log('add new option', value, data);
      // add the user to db table
      addPerson(value);
      // refresh table
      refreshTable();
    }
  });
}

// Detect Paste!
//
function getTextAreaSelection(textarea) {
  var start = textarea.selectionStart, end = textarea.selectionEnd;
  return {
    start: start,
    end: end,
    length: end - start,
    text: textarea.value.slice(start, end)
  };
}

function detectPaste(textarea, callback) {
    textarea.onpaste = function() {
        // save cursor position
        var cstart = this.selectionStart,
        cend = this.selectionEnd,
        elem = this;

        var sel = getTextAreaSelection(textarea);
        var initialLength = textarea.value.length;
        window.setTimeout(function() {
            var val = textarea.value;
            var pastedTextLength = val.length - (initialLength - sel.length);
            var end = sel.start + pastedTextLength;
            callback({
                start: sel.start,
                end: end,
                length: pastedTextLength,
                text: val.slice(sel.start, end),
                elem: elem
            });
        }, 1);
    };
}

String.prototype.replaceBetween = function(start, end, what) {
    return this.substring(0, start) + what + this.substring(end);
};


function buildFullTable() {
  var notEmpty = buildHtmlTable('#excelDataTable', db, {
    name: 'action',
    value: '<button class="btn btn-xs btn-danger deleteUser">×</button>'
  });

  if (!notEmpty) {
    showGroupEmptyWell();
  }

  // $('.deleteUser').click(function(e) {
  //   var row = $(e.target).parent().parent();
  //   var name = row.children()[0].innerHTML;
  //   delete db[name];
  //   saveDB();
  //   toggleGroupsMenu(false);
  //   // row.remove();
  //   // console.log('row', row.children()[0].innerHTML);
  // })
}


function clearAllTables() {
  $('#excelDataTable').html('');
  $('#groupDataTable').html('');
}

function changeSiteTitle(newtitle) {
  $('.menuTitle').html(newtitle);
}

function toggleMenuItems(showGroupsMenu) {
  if (showGroupsMenu) {
    $('.poolview').hide();
    $('.groupview').show()
  } else {
    $('.groupview').hide();
    $('.poolview').show();
  }
}

function toggleGroupsMenu(showGroupsMenu) {

  if (showGroupsMenu) {
    // change title
    changeSiteTitle(DEFAULT_MENU_TITLE);
    // toggle menu
    toggleMenuItems(true);
    // hide data table
    clearAllTables();
    // show all groups table
    // groupdb = getDBJSONValue('ppdb');
    var tempdb = {};
    $.each(groupdb, function(key, value) {
      tempdb[key] = {
        group: key,
        pool: _setToArray(value).join(', ')
      };
    });
    var notEmpty = buildHtmlTable('#groupDataTable', tempdb, {
      name: 'action',
      value: '<button class="btn btn-xs btn-danger deleteGroup">×</button>'
    });

    if (!notEmpty) {
      showPoolEmptyWell();
    }

    $('.deleteGroup').click(function(e) {
      var row = $(e.target).parent().parent();
      var name = row.children()[0].innerHTML;
      console.log('name', name)
      delete groupdb[name];
      // don't save current db just global db save
      saveDB(true);
      toggleGroupsMenu(true);
      // row.remove();
      // console.log('row', row.children()[0].innerHTML);
    })

    $('#groupDataTable > tbody > tr > td').click(function(e) {
      var selectedGroup = $(e.target).parent().children()[0].innerHTML;
      console.log($(e.target).parent().children()[0].innerHTML);
      // switch db to current selected value
      setDBJSONValue('currentppgroup', selectedGroup);
      db = getDBJSONValue('ppdb')[selectedGroup];
      setCurrentGroup(selectedGroup);

      toggleGroupsMenu(false);


    });
  } else {
    // change title
    changeSiteTitle(toTitleCase(currentdb));
    // toggle menu
    toggleMenuItems(false);
    // hide group table
    clearAllTables();
    buildFullTable();
    // initializeBlacklist();
  }

}

$(window).ready(function() {

  $(document).on('click', '.deleteUser',function(e) {
    var row = $(e.target).parent().parent();
    var name = row.children()[0].innerHTML;
    delete db[name];
    saveDB();
    toggleGroupsMenu(false);
    // row.remove();
    // console.log('row', row.children()[0].innerHTML);
  })

  $(document).on('click', '.blacklist-select', function(e) {
    console.log('licked on input', e, $(this), $(this).hasClass('selectize-control'), $(this).attr('class'), e.target)
    if (!$(this).hasClass('selectize-control')) {
      $(this).selectize({
        delimiter: ',',
        plugins: ['remove_button'],
        maxItems: null,
        valueField: 'name',
        labelField: 'name',
        searchField: 'name',
        options: _dictToArray(db),
        create: true,
        onItemAdd: function(value, $item) {
          // Add to person's black list
          var p = db[this.$input.data('person')];
          p.blacklist[value] = true;
          console.log('add', this, value, $item, this.$input.data('person'));
          saveDB();
        },
        onItemRemove: function(value) {
          var p = db[this.$input.data('person')];
          delete p.blacklist[value];
          console.log('delete', value);
          saveDB();
        },
        onBlur: function() {
          saveDB();
        },
        onOptionAdd: function(value, data) {
          console.log('add new option', value, data);
          // add the user to db table
          addPerson(value);
          // refresh table
          refreshTable();
        }
      });
    }
  });

  if (!db || db == undefined) {
    toggleGroupsMenu(true);
  } else {
    toggleGroupsMenu(false);
  }


  function bindModelInput(obj, property, domElem) {
  Object.defineProperty(obj, property, {
    get: function() { return domElem.value; },
    set: function(newValue) { domElem.value = newValue; },
    configurable: true
  });

  var textarea = document.getElementById("prayerPool");
  detectPaste(textarea, function(pasteInfo) {
      console.log(pasteInfo.text, pasteInfo);

      var str = pasteInfo.text.split('\n').join(', ') + ', ';

      textarea.value = textarea.value.replaceBetween(pasteInfo.start,
          pasteInfo.end, str);


      // restore cursor from variables...
      console.log('start/end', pasteInfo.start, pasteInfo.start + str.length);
      pasteInfo.elem.setSelectionRange(pasteInfo.start, pasteInfo.start + str.length);
      // pasteInfo also has properties for the start and end character
      // index and length of the pasted text
  });
}

//<input id="foo">
user = {}
bindModelInput(user,'name',document.getElementById('foo')); //hey presto, we now have two-way data binding.




function drawTable(data) {
  var table = $('<table class="table table-bordered">');
  for (var i in data) {
    if (typeof data[i] === 'object')
      drawRow(table, i, data[i]);
  }

  return table;
}

function drawRow(table, key, rowData) {
  var row = $("<tr />")
  table.append(row); //this will append tr element to table... keep its reference for a while since we will add cels into it
  row.append($("<td><b>" + key + "</b></td>"));
  for (var i=0; i<rowData.length; i++) {
    var data = rowData[i];
    if ($.type(data) == 'string') {
      row.append($("<td>" + data + "</td>"));
    } else {
      row.append($("<td>" + data.k + "</td>"));
    }

  }
}


function sortHistory(history) {
  var temp = [];
  $.each(history, function(key, value) {
    temp.push({v:value, k: key});
  });
  temp.sort(function(a,b){
   if(a.v > b.v){ return 1}
    if(a.v < b.v){ return -1}
      return 0;
  });

  return temp;
}

$('#pairsModal').on('show.bs.modal', function (event) {
  var button = $(event.relatedTarget) // Button that triggered the modal
  // var recipient = button.data('whatever') // Extract info from data-* attributes
  // If necessary, you could initiate an AJAX request here (and then do the updating in a callback).
  // Update the modal's content. We'll use jQuery here, but you could use a data binding library or other methods instead.
  var modal = $(this)
  // modal.find('.modal-title').text('New message to ' + recipient)
  var pairdb = {};
  for (var key in db) {
    var user = db[key];
    pairdb[key] = sortHistory(user.history);
  }

  var table = drawTable(pairdb);
  modal.find('.modal-body').empty().append(table);
});

$('#editUserModal').on('show.bs.modal', function (event) {
  var button = $(event.relatedTarget) // Button that triggered the modal
  // var recipient = button.data('whatever') // Extract info from data-* attributes
  // If necessary, you could initiate an AJAX request here (and then do the updating in a callback).
  // Update the modal's content. We'll use jQuery here, but you could use a data binding library or other methods instead.
  var modal = $(this);
  // populate with existing users
  var str = _dictKeysToArray(db).join(', ');
  modal.find('#prayerPool').text(str);
});

$('.autosubmit').submit(function(e) {
  // click on primary button
  $(this).find('.btn-primary').click();
})

$('#addGroup').click(function(e) {
    // Save the form data via an Ajax request
    e.preventDefault();

    var name = $('#newGroupName').val();
    console.log(name);

    groupdb[name] = {};

    db = {};
    setCurrentGroup(name);
    saveDB();
    toggleGroupsMenu(false);
    // // refreshTable();

    // console.log('success!', name);

    $("#addGroupModal").modal("hide");
});

$('#savePool').click(function(e) {
    // Save the form data via an Ajax request
    e.preventDefault();

    var textarea = $('#prayerPool'),
        list = textarea.val().split(','),
        user, newdb = {};

    // loop through text and add users not already added
    for (var i = 0; i < list.length; i++) {
      user = list[i].trim(' ');
      if (user == undefined || user.trim(' ') == '') {
        continue;
      }
      if (user in db) {
        // add it
        newdb[user] = db[user];
      } else {
        newdb[user] = addPerson(user);
      }

    }

    db = newdb;
    saveDB();
    refreshTable();

    console.log('success!', textarea);

    $("#editUserModal").modal("hide");
});


$('#viewGroupMenu').click(function() {
  setCurrentGroup(undefined);
  // toggle view
  toggleGroupsMenu(true);
});

// Every time a modal is shown, if it has an autofocus element, focus on it.
$('.modal').on('shown.bs.modal', function() {
  $(this).find('[autofocus]').focus();
});

});

// $('#savePool').click(function(e) {

// })


  </script>

</head>
<body>
<nav class="navbar navbar-default navbar-fixed-top">
  <div class="container-fluid">
    <div class="navbar-header">
      <a id="viewGroupMenu" class="navbar-brand" href="#"><span class="glyphicon glyphicon-menu-hamburger"></span> <span class="menuTitle">Prayer Pair generator!</span></a>

    </div>

    <form class="navbar-form navbar-left" role="search">
      <button type="button" class="btn btn-success poolview" data-toggle="modal" data-target="#editUserModal">
        Edit Pool
      </button>
      <button type="button" class="btn btn-success groupview" data-toggle="modal" data-target="#addGroupModal">
        Add Group
      </button>
    </form>

    <form class="navbar-form navbar-right" role="search">
        <button type="button" class="btn btn-primary" onclick="pairup();">
          Pair up
        </button>
        <!-- Button trigger modal -->
        <button type="button" class="btn btn-default" data-toggle="modal" data-target="#pairsModal">
          View Prayer Pairs
        </button>
        <button type="button" class="btn btn-danger" onclick="clearState();">
          Reset
        </button>
    </form>


  </div>
</nav>
<h3>Prayer Pair generator!</h3>

  <table id="excelDataTable" class="table table-bordered table-hover">
  </table>
  <table id="groupDataTable" class="table table-bordered table-hover">
  </table>

<!-- Modal -->
<div class="modal fade" id="addGroupModal" tabindex="-1" role="dialog" aria-labelledby="addGroupModalLabel">
  <div class="modal-dialog" role="document">
    <div class="modal-content">
      <form action="" class="autosubmit">
        <div class="modal-header">
          <button type="button" class="close" data-dismiss="modal" aria-label="Close"><span aria-hidden="true">&times;</span></button>
          <h4 class="modal-title" id="addGroupModalLabel">Create New Group</h4>
        </div>
        <div class="modal-body">
          <p>New Group Name</p>
          <input autofocus="autofocus" id="newGroupName" class="form-control" placeholder="e.g. calstate-la brothers" />
        </div>
        <div class="modal-footer">
          <button type="button" class="btn btn-default" data-dismiss="modal">Cancel</button>
          <button type="button" id="addGroup" class="btn btn-primary">Add Group</button>
        </div>
      </form>
    </div>
  </div>
</div>

<!-- Modal -->
<div class="modal fade" id="editUserModal" tabindex="-1" role="dialog" aria-labelledby="editUserModalLabel">
  <div class="modal-dialog" role="document">
    <div class="modal-content">
      <div class="modal-header">
        <button type="button" class="close" data-dismiss="modal" aria-label="Close"><span aria-hidden="true">&times;</span></button>
        <h4 class="modal-title" id="editUserModalLabel">Prayer Partner Pool</h4>
      </div>
      <div class="modal-body">
        <p>Enter partner names (e.g. Joe Doe, Jane Smith). You can also paste data from excel</p>
        <textarea autofocus="autofocus" id="prayerPool" class="form-control" placeholder="Partner names (e.g. Joe Doe, Jane Smith) Paste data from excel" rows="3"></textarea>
      </div>
      <div class="modal-footer">
        <button type="button" class="btn btn-default" data-dismiss="modal">Cancel</button>
        <button type="button" id="savePool" class="btn btn-primary">Save changes</button>
      </div>
    </div>
  </div>
</div>

<!-- Modal -->
<div class="modal fade" id="pairsModal" tabindex="-1" role="dialog" aria-labelledby="pairsModalLabel">
  <div class="modal-dialog" role="document">
    <div class="modal-content">
      <div class="modal-header">
        <button type="button" class="close" data-dismiss="modal" aria-label="Close"><span aria-hidden="true">&times;</span></button>
        <h4 class="modal-title" id="pairsModalLabel">Prayer Pairs</h4>
      </div>
      <div class="span12" style="overflow: auto">
      <div class="modal-body">
        ...
      </div>
    </div>
      <div class="modal-footer">
        <button type="button" class="btn btn-default" data-dismiss="modal">Close</button>
        <!-- <button type="button" class="btn btn-primary">Save changes</button> -->
      </div>
    </div>
  </div>
</div>

<div id="pairWarning" class="modal fade" tabindex="-1" role="dialog">
  <div class="modal-dialog">
    <div class="modal-content">
      <div class="modal-header">
        <button type="button" class="close" data-dismiss="modal" aria-label="Close"><span aria-hidden="true">&times;</span></button>
        <h4 class="modal-title">Note</h4>
      </div>
      <div class="modal-body">
        <p>Tried to randomly assign pairs 100 times but no valid combinations found without violating blacklist + history constraints! You may have reached theoretical limit and need to reset or you can try you luck and hit "pair up" again. :)</p>
      </div>
      <div class="modal-footer">
        <button type="button" class="btn btn-default" data-dismiss="modal">Close</button>
      </div>
    </div><!-- /.modal-content -->
  </div><!-- /.modal-dialog -->
</div><!-- /.modal -->

</body>
</html>